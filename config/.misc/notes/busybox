
#############
busybox only log server...
 -------------
 syslogd -R 172.16.0.1:514 -StD
 udpsvd 0.0.0.0 514 tee -a /tmp/logfile
 -------------
 cli - udpsvd 0.0.0.0 4444 stdbuf -oL /bin/udpsvd.script
 udpsvd.script - exec tr -cd 'a-zA-Z0-9' <&0 >>/tmp/udpsvd.log
 ^ actually works
 -------------
#############

-------------

 [shlel - daemon wrapper]

  chuid/chgid
  reset env
  terminal detach
  stdin/stdout/stderr redirection
  background
  close initial shell

 * (setsid command </dev/null &>/dev/null & exit)

 * su -l -s /bin/sh -c 'setsid command </dev/null &>/dev/null & exit' user

 (setsid \
 setpriv \
 --reuid <user> --regid <group> --init-groups
 --nnp --reset-env \
 --inh-caps <caps> \
 --ambient-caps <caps> \
 --bounding-set <caps> \
 command </dev/null &>/dev/null & exit)

-------------

#############
-------------
         exec - replace current shell with command
 background & - execute in parallel
     {inline} - execute inline
   (subshell) - execute inside a subshell
   </dev/null - replace stdin
  &>/dev/null - replace stdout & stderr
-------------
ash -l            [-c 'command'] <user> [< file] [<< EOF]
 su -l -s /bin/sh [-c 'command'] <user> [< file] [<< EOF]
 setsid <command>
 setpriv --reuid --regid --init-groups --reset-env --nnp --ambient-caps --inh-caps --bounding-set <command>
 env -i <command>
 chroot /path <command>
-------------
su -l -s /bin/ash <user> << EOF # horrible \$(escape) \${characters}
su -l -s /bin/ash <user> < /path/to/file # works without \${escapes}
-------------
su -l -s /bin/ash <user> < /path/to/file > /path/to/output
dbclient -T <user>@172.16.0.1 < /path/to/file > /path/to/output
-------------
#############
busybox with unix_sockets - nc -lks local:/dev/shm/socket -e dbclient user@172.16.0.1 nc local:/dev/shm/socket
#############
0 0 1 1 * year
0 0 1 * * month
0 0 * * 0 week
0 0 * * * day
0 * * * * hour
* * * * * minute
m h d m w
i o a o e
n u y n e
u r   t k
t     h
e
#############

#############
setsid    - run program in a new session
taskset   - lock processes to cores
nice      - runs a program with modified scheduling priority
renice    - alters the scheduling priority of one or more running processes
ionice    - set program io scheduling class and priority
chrt      - manipulate real-time attributes of a process
choom     - echo 123 > /proc/1/oom_score_adj -999 unlikerly to be killed 1000 likely to be killed
#############

-------------

 [setsid]

  setsid command </dev/null &>/dev/null

  start <command> in new session
  removes controlling tty
  redirects stdin stdout stderr

  prevents process from sending SIGNALS to controlling terminal

  setsid su -l -s /bin/sh -c '<command>' <user> [</dev/null] [&>/dev/null]

-------------

 [tasket]

  taskset -p <hexmask> <pid>
  taskset    <hexmask> <prog> <args>

  cat /proc/$$/status | grep -e Cpus_allowed

-------------

 [nice/renice]

     ulimits -e {0-39} # scheduling priority
 renice -n +1 -u $USER # incrementing allowed                 (reduces  scheduling priority)
 renice -n -1 -u $USER # decrementing allowed upto ulimits -e (increase scheduling priority)

------------- 

 [ionice]

 ionice -p <pid> < - display priority

 ionice -c 1 -n {0-7} -p $$ < - root only real time
 ionice -c 2 -n {0-7} -p $$ < - none root best effort
 ionice -c 3          -p $$ < - none root idle

 defaults to best-effort:2 priority:4

 if unassigned derives priority from process nice level

 io_priority = nice + 20 / 5

-------------

 [chrt]

     RR chrt -pr (1-99) -p $$ NICE: -   PRIORITY: 1(41) 99(139) root only
   FIFO chrt -pf (1-99) -p $$ NICE: -   PRIORITY: 1(42) 99(139) root only
  OTHER chrt -po (0)    -p $$ NICE: -20 PRIORITY: 0(39)         none root
  BATCH chrt -pb (0)    -p $$ NICE: -20 PRIORITY: 0(39)         none root
   IDLE chrt -pi (0)    -p $$ NICE: -   PRIORITY: 0(39)         none root

  ulimits -r 30 # realtime priority
 chrt -pr 29 $$ # true
 chrt -pr 31 $$ # fail

^ realtime priority allows changing rr || fifo from 1-99 (auto appending +39 from nice)

-------------

 [choom]

  display and adjust oom-killer score

  echo 123 > /proc/1/oom_score_adj

  -999 unlikely to be killed
  1000 likely to be killed

#############

[ busybox_init ]

 /init - > /etc/inittab - > /etc/init - > /etc/profile

     umask - sanity check
 variables - global
       PS1 - unique to ${USER} shell prompt
       set - control default shell options
   ulimits - default pid limits unique to ${USER}
    renice - default nice levels unique to ${USER}
   aliases - global
 functions - global

   root:
desktop: input:/dev/input video:/dev/dri
   toor: audio:/dev/snd

#############

 [busybox]

 * default - enable all long options
 ^ some binaries do nothing
   others get increased functionality

 - vi inline editing CONFIG_FEATURE_EDITING_VI
 ^ set -o vi (doesnt turn on when disabled)
 ^ (exists in set -o output regardless)

 * track window size changes
 * FEATURE_EDITING_WINCH - turned on the PS1 reprint disabled
 ? query cursor position from terminal
 ^ settings claims 'more robust'
 ^ vi claims last ditch effort
 ^ less claims last ditch effort
 ^^ made it uniform (global+vi+less)

 * unicode support - stop printing dumb characters on output

 -archival utilities-

 ? unzip - firmware files are always .zip encoded... gets annoying

 -coreutils-

  * CONFIG_FEATURE_PRESERVE_HARDLINKS ?
  ^ mv does preserve hardlinks 
  ^ cp doesnt preserve hardlinks misleading ?
  ^^ tl;dr fuck hardlinks no visability and weird functionality

  * copy long options --reflink (ext4 doesnt support it)

  ? ls - fairly sure -w <width> doesnt do anything ?

  ? head and tail - fancy output options dont match ?

  * expr - more hardened compared to test ?
  * test - extend test to 64 bit (assuming larger numbers ?)
  ^ test --help would be awesome...

  ** touch - SUSV3 allows timestamps etc ?

 -console utilities-
 -debian utilities-

  * run-parts - technically awesome for cronjobs / config directories (hard requirement for acpid)

 -klibc-utils-
 -editors-

  * diff long options - doesnt do anything

 -find utilities-
 -init utilities-

  ? linuxrc - remove pid1 check allow init as supervisor daemon in chroots ?

 -login/password management utilities-
 -linux ext2 fs progs-
 -linux module utilities-
 -linux system utilities-

 * setpriv - wish it worked ?

 * mkswap - testing zram zswap
 * swapon - testing zram zswap
 * swapoff - testing zram zswap

 * acpid - know what it does provides extra functionality ?
 * uevent - prints out udev information (suppose to be used with mdev)

 * getopt isnt getopts ?
 ^ norm: enable shell built-in and applet
 ^ breaks norm different name / program...

 -miscellaneous utilities-

 * crond - -fd (foreground and log to stderr for debug?)
 * hdparm - doesnt support hdparm -W /dev/disk to view write cache status...

 -misc utilities-

  * microcom - used it to flash openwrt devices...

 -networking-
 -print utilities-
 -mail utilities-
 -process utilities-
 -runinit utilities-
 -shells-

 * CONFIG_FEATURE_SH_NOFORK - may significantly speed up shell scripts ?
 ^ grep APPLET_NOFORK include/applets.h | grep ^IF | wc -l == 40 applets only ?

 -system logging utilities-

-------------

 busybox
  doesnt need
   libcrypt
   libm
   librt
  needs
   libresolv

 ^ login/password management utilities - internal crypt stuff removed dependencies

 ? more than nslookup using libresolv... (it uses internal code?)

 ^ qemu silently linking to glibc for alot of libraries...

-------------
  * echo -n -e 
  ^ check $variable with -tac fuck ups...
  *  command $variable - always parses -tac options
  *  "force it to be read as a single arguement"
  *  ^ anything with a space dies
-------------
#############


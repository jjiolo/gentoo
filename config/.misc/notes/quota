
#############
sys-fs/quota
#############

 [current state]

 tmpfs - accepts mount option
         ignored in /proc/mounts

 quota
 usrquota
 grpquota
 usrquota_block_hardlimit=1G
 usrquota_inode_hardlimit=1000
 grpquota_block_hardlimit=1G
 grpquota_inode_hardlimit=1000

 ^ dynamic with % hardlimits ?

 quotacheck - deprecated ?
 ext4 - tune2fs -O quota /dev/block
 tmpfs - uses hidden files automagically

 cant automate ? if ephemeral do quota || forces manual ext4
 ^ deprecating quotacheck forces manually enabling it ?
 ^ -o hardlimits for every user quick fix to secure ddos ?

 ? quota projects ?
 /etc/projid + chattr -p project
 apply quota limits to a sub directory...

#############

 [installs]

 /aquota.user - file used to store quota information
 /aquota.group - file used to store quota information

 bin
  quota - display usage and limits
  quotasync - sync filesystem usage to disk

 sbin
  convertquota - conver old to new file format
  edquota - edit quotas (tmp file then binary format)
  quotacheck - scan filesystem, create check and repair usage
  quotaoff - enable or disable disk quota
  quotaon - enable or disable disk quota
  quotastats - program to query quota statistics
  repquota - summarize quotas for a filesystem
  setquota - set disk quotas
  warnquota - send mail to users over softlimit ?
  xqmstats - xfs statistics

 etc
  quotagrpadmins
  quotatab
  warnquota.conf

#############

# ext4
mkfs.ext4 -L label -m 0 /dev/block
tune2fs -O quota /dev/block

# mount
default="rw,nodev,nosuid,noexec,noatime"
tmpfs="mode=1777,size=50%"
quota="quota,usrquota,grpquota"
mount -t tmpfs -o ${default},${tmpfs},${quota} tmpfs /tmp
mount -t ext4 -o ${default},${quota} /dev/block /path

# ??? not needed for ext4 or tmpfs ???
# setup /.aquota.user /.aquota.group
quotacheck -vaugcF=vfsv1 # --verbose --all --user --group --create-files --format=vfsv1
# ^ -M --try-remount -m --no-remount (read only or out of sync)
# ^ -i --interactive -n --use-first-dquot (corrupted quota file)
# -a (/etc/mtab) or /path/to/filesystem
# ??? not needed for ext4 or tmpfs ???

# set quotas --all --edit-period
setquota -au <user> <block-soft> <block-hard> <inode-soft> <inode-hard>
setquota -at <block-grace> <inode-grace>

# enable
quotaon -ap # display quota state
quotaon -a  # enable quota
quotaon -af # disable quota (doesnt work?)

# monitoring
quotasync -augP # sync kernel quota
repquota -vaugs # --verbose --all --user --group --human-readable

#############

 [minimum]

  quotaon - turn it on/off
  setquota - set limits
  repquota - display limits

#############


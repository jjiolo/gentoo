
umask 0022
#############
install -d -o httpd -g httpd -m 0700 /run/git
git init --bare --initial-branch project /run/git/project
git clone file:///run/git/project /run/git/working
#############
install -d -o httpd -g httpd -m 0700 /run/git ; chown -R httpd:httpd /run/git
find "/run/git" -type d -mindepth 1 -exec chmod 0700 {} \;
find "/run/git" -type f -mindepth 1 -exec chmod 0600 {} \;
#############

#############
cat > /tmp/storage/services/httpd/webroot/cgi-bin/project.cgi << EOF
printf "%s\n\n" "Content-type: text/html"
printf "%s\n" "\$(date +%Y:%m:%d:%H:%M:%S) : \$(uname -a)"
EOF
#############
cat > /tmp/storage/services/httpd/webroot/cgi-bin/project.git << EOF
GIT_PROJECT_ROOT=/run/git/project GIT_HTTP_EXPORT_ALL= exec /usr/libexec/git-core/git-http-backend
EOF
#############
chown root:httpd /tmp/storage/services/httpd/webroot/cgi-bin/project.*
chmod 0640 /tmp/storage/services/httpd/webroot/cgi-bin/project.*
#############
umask 0077

